<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment Results - CNRD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .risk-card {
            padding: 30px;
            margin: 25px 0;
            border-radius: 15px;
            text-align: center;
            border: 3px solid;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .risk-healthy {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-color: #28a745;
        }
        
        .risk-moderate {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border-color: #ffc107;
        }
        
        .risk-severe {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border-color: #dc3545;
        }
        
        .score-display {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .confidence-bar {
            background: #e0e0e0;
            height: 30px;
            border-radius: 20px;
            overflow: hidden;
            margin: 15px auto;
            max-width: 500px;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 20px;
            background: linear-gradient(90deg, #28a745 0%, #ffc107 50%, #dc3545 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 1s ease;
        }
        
        .component-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .component-score {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }
        
        .component-score h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .component-score .score {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .score-low { color: #28a745; }
        .score-medium { color: #ffc107; }
        .score-high { color: #dc3545; }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        
        .analysis-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            padding: 25px;
            border-radius: 15px;
        }
        
        .analysis-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        th {
            background: #3498db;
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin: 15px 0;
        }
        
        .blood-interpretation {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 5px solid #3498db;
        }
        
        .status-normal { border-left-color: #28a745; background: #f8fff9; }
        .status-low { border-left-color: #ffc107; background: #fffdf5; }
        .status-high { border-left-color: #dc3545; background: #fff8f8; }
        
        .recommendations {
            background: linear-gradient(135deg, #e8f4fd 0%, #d6eaff 100%);
            border: 3px solid #3498db;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }
        
        .recommendations h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .recommendations ul {
            margin-left: 25px;
        }
        
        .recommendations li {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        
        .btn-container {
            text-align: center;
            margin: 40px 0;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        .disclaimer {
            background: #fff3cd;
            border: 3px solid #ffc107;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .no-data {
            text-align: center;
            padding: 30px;
            color: #6c757d;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .component-scores {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .btn-container {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Nutrition Risk Assessment Results</h1>
            <p>Comprehensive Multi-Modal Analysis</p>
        </div>
        
        <div class="content">
            <!-- Main Risk Card -->
            <div class="risk-card risk-{{ risk_level|default('moderate') }}">
                <div class="score-display">
                    {{ final_prediction|default('Assessment Complete') }}
                </div>
                <div>
                    <h3>Confidence: {{ "%.1f"|format(confidence|default(50)) }}%</h3>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: {{ confidence|default(50) }}%;">
                            {{ "%.1f"|format(confidence|default(50)) }}%
                        </div>
                    </div>
                    <p style="font-size: 1.2em; margin-top: 15px;">
                        <strong>Combined Risk Score: {{ "%.3f"|format(total_risk_score|default(0.5)) }}/1.0</strong>
                    </p>
                </div>
            </div>

            <!-- Component Scores -->
            <div class="component-scores">
                <div class="component-score">
                    <h4>üìä Demographic Analysis</h4>
                    {% set demo = demographic_risk|default(0.0)|float %}
                    <div class="score {% if demo < 0.3 %}score-low{% elif demo < 0.7 %}score-medium{% else %}score-high{% endif %}">
                        {{ "%.3f"|format(demo) }}
                    </div>
                    <p>Anthropometric assessment</p>
                </div>
                
                <div class="component-score">
                    <h4>üë§ Facial Analysis</h4>
                    {% set face = face_score|default(0.0)|float %}
                    <div class="score {% if face < 0.3 %}score-low{% elif face < 0.7 %}score-medium{% else %}score-high{% endif %}">
                        {{ "%.3f"|format(face) }}
                    </div>
                    <p>Visual malnutrition indicators</p>
                </div>
                
                <div class="component-score">
                    <h4>üìà Growth Analysis</h4>
                    {% set growth = growth_score|default(0.0)|float %}
                    <div class="score {% if growth < 0.3 %}score-low{% elif growth < 0.7 %}score-medium{% else %}score-high{% endif %}">
                        {{ "%.3f"|format(growth) }}
                    </div>
                    <p>Growth pattern evaluation</p>
                </div>
                
                <div class="component-score">
                    <h4>ü©∏ Blood Analysis</h4>
                    {% set blood = blood_score|default(0.0)|float %}
                    <div class="score {% if blood < 0.3 %}score-low{% elif blood < 0.7 %}score-medium{% else %}score-high{% endif %}">
                        {{ "%.3f"|format(blood) }}
                    </div>
                    <p>Laboratory markers</p>
                </div>
            </div>

            <div class="analysis-grid">
                <!-- Demographic Data -->
                <div class="analysis-section">
                    <h3>üìã Demographic & Anthropometric Data</h3>
                    {% if parameters %}
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for param, value in parameters.items() %}
                            <tr>
                                <td><strong>{{ param }}</strong></td>
                                <td>{{ value }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <div class="no-data">No demographic data available</div>
                    {% endif %}
                </div>

                <!-- Image Analysis -->
                {% if (face_score|default(0)|float > 0) or (growth_score|default(0)|float > 0) or (image_paths and (image_paths.face or image_paths.growth)) %}
                <div class="analysis-section">
                    <h3>üì∏ Image Analysis Results</h3>
                    
                    {% if face_score|default(0)|float > 0 or (image_paths and image_paths.face) %}
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: #2c3e50;">üë§ Facial Analysis</h4>
                        <p><strong>Risk Score:</strong> {{ "%.3f"|format(face_score|default(0)|float) }}</p>
                        
                        {% set face_val = face_score|default(0)|float %}
                        <div style="padding: 15px; margin: 10px 0; border-left: 4px solid 
                             {% if face_val < 0.3 %}#28a745{% elif face_val < 0.7 %}#ffc107{% else %}#dc3545{% endif %}; 
                             background: {% if face_val < 0.3 %}#f8fff9{% elif face_val < 0.7 %}#fffdf5{% else %}#fff8f8{% endif %};">
                            {% if face_val < 0.3 %}
                                <strong style="color: #28a745;">‚úÖ Low Risk:</strong> No significant malnutrition indicators detected in facial features.
                            {% elif face_val < 0.7 %}
                                <strong style="color: #856404;">‚ö†Ô∏è Moderate Risk:</strong> Some malnutrition indicators present in facial analysis.
                            {% else %}
                                <strong style="color: #721c24;">üö® High Risk:</strong> Multiple malnutrition indicators detected through facial analysis.
                            {% endif %}
                        </div>
                        
                        {% if image_paths and image_paths.face %}
                        <img src="{{ url_for('static', filename='uploads/' + image_paths.face) }}" 
                             alt="Facial analysis" class="image-preview">
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if growth_score|default(0)|float > 0 or (image_paths and image_paths.growth) %}
                    <div>
                        <h4 style="color: #2c3e50;">üìà Growth Chart Analysis</h4>
                        <p><strong>Risk Score:</strong> {{ "%.3f"|format(growth_score|default(0)|float) }}</p>
                        
                        {% set growth_val = growth_score|default(0)|float %}
                        <div style="padding: 15px; margin: 10px 0; border-left: 4px solid 
                             {% if growth_val < 0.3 %}#28a745{% elif growth_val < 0.7 %}#ffc107{% else %}#dc3545{% endif %}; 
                             background: {% if growth_val < 0.3 %}#f8fff9{% elif growth_val < 0.7 %}#fffdf5{% else %}#fff8f8{% endif %};">
                            {% if growth_val < 0.3 %}
                                <strong style="color: #28a745;">‚úÖ Normal Growth:</strong> Growth patterns appear within normal parameters.
                            {% elif growth_val < 0.7 %}
                                <strong style="color: #856404;">‚ö†Ô∏è Growth Concerns:</strong> Some growth irregularities detected.
                            {% else %}
                                <strong style="color: #721c24;">üö® Growth Issues:</strong> Concerning growth patterns detected.
                            {% endif %}
                        </div>
                        
                        {% if image_paths and image_paths.growth %}
                        <img src="{{ url_for('static', filename='uploads/' + image_paths.growth) }}" 
                             alt="Growth chart" class="image-preview">
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Blood Parameters -->
                {% if blood_score|default(0)|float > 0 or (blood_interpretations and blood_interpretations|length > 0) %}
                <div class="analysis-section">
                    <h3>ü©∏ Blood Parameters Analysis</h3>
                    <p style="margin-bottom: 15px;"><strong>Overall Blood Risk:</strong> {{ "%.3f"|format(blood_score|default(0)|float) }}</p>
                    
                    {% if blood_interpretations and blood_interpretations|length > 0 %}
                    <h4 style="margin-top: 20px; margin-bottom: 15px; color: #2c3e50;">Detailed Results:</h4>
                    {% for param, details in blood_interpretations.items() %}
                    <div class="blood-interpretation status-{{ details.status|lower|replace(' ', '') }}">
                        <h5 style="color: #2c3e50; margin-bottom: 5px;">{{ param }}</h5>
                        <p><strong>Value:</strong> {{ details.value }}</p>
                        <p><strong>Status:</strong> {{ details.status }}</p>
                        <p><strong>Normal Range:</strong> {{ details.normal_range }}</p>
                        <p style="margin-top: 5px; font-size: 0.95em;">{{ details.clinical_significance }}</p>
                    </div>
                    {% endfor %}
                    {% else %}
                    <table>
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for param, value in blood_parameters.items() %}
                            {% if value and value != "Not provided" %}
                            <tr>
                                <td><strong>{{ param }}</strong></td>
                                <td>{{ value }}</td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <!-- Recommendations -->
            <div class="recommendations">
                <h3>üí° Clinical Recommendations</h3>
                
                {% set risk = risk_level|default('moderate') %}
                
                {% if risk == 'healthy' %}
                <div style="border-left: 4px solid #28a745; padding-left: 20px;">
                    <h4 style="color: #28a745;">‚úÖ Low Risk - Maintenance Care</h4>
                    <ul>
                        <li><strong>Continue current nutrition practices</strong></li>
                        <li>Regular monitoring every 3-6 months</li>
                        <li>Maintain vaccination schedules</li>
                        <li>Promote healthy eating habits</li>
                    </ul>
                </div>
                {% elif risk == 'moderate' %}
                <div style="border-left: 4px solid #ffc107; padding-left: 20px;">
                    <h4 style="color: #856404;">‚ö†Ô∏è Medium Risk - Enhanced Monitoring</h4>
                    <ul>
                        <li><strong>Schedule pediatric appointment within 2-4 weeks</strong></li>
                        <li>Comprehensive dietary evaluation needed</li>
                        <li>Monthly weight and height measurements</li>
                        <li>Increase protein and micronutrient-rich foods</li>
                        <li>Consider nutritional supplements if recommended</li>
                    </ul>
                </div>
                {% else %}
                <div style="border-left: 4px solid #dc3545; padding-left: 20px;">
                    <h4 style="color: #721c24;">üö® High Risk - Immediate Intervention</h4>
                    <ul>
                        <li><strong>URGENT: Seek immediate medical attention</strong></li>
                        <li>Complete medical and nutritional assessment required</li>
                        <li>Consider therapeutic feeding programs</li>
                        <li>Specialist referrals may be necessary</li>
                        <li>Weekly monitoring and medical supervision</li>
                    </ul>
                </div>
                {% endif %}
            </div>

            <!-- Action Buttons -->
            <div class="btn-container">
                <a href="{{ url_for('index') }}" class="btn">üìù New Assessment</a>
                <button onclick="window.print()" class="btn btn-secondary">üñ®Ô∏è Print Results</button>
                <a href="{{ url_for('history') }}" class="btn btn-secondary">üìä View History</a>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">üö™ Logout</a>
            </div>

            <!-- Disclaimer -->
            <div class="disclaimer">
                <p><strong>‚ö†Ô∏è Medical Disclaimer:</strong></p>
                <p>This assessment is a screening tool only and should never replace professional medical diagnosis or treatment. Always consult qualified healthcare professionals for medical decisions. If a child shows signs of severe malnutrition, seek immediate emergency medical attention.</p>
            </div>
        </div>
    </div>

    <script>
        // Animate confidence bar
        window.addEventListener('load', function() {
            const fill = document.querySelector('.confidence-fill');
            if (fill) {
                const targetWidth = fill.style.width;
                fill.style.width = '0%';
                setTimeout(() => {
                    fill.style.width = targetWidth;
                }, 500);
            }
        });
    </script>
</body>
</html>